var getActiveElement=function(document){
  document=document||window.document;
  if(document.body===document.activeElement||document.activeElement.tagName=='IFRAME'){
    var iframes=document.getElementsByTagName('iframe');
    for(var i=0;i<iframes.length;i++){
      var focused=getActiveElement(iframes[i].contentWindow.document);
      if(focused!==false){
        return focused;
      }
    }
  }
  else return document.activeElement;
  return false;
};

var characters = {
  a1 : '263A',
  a2 : '263B',
  a3 : '2665',
  a4 : '2666',
  a5 : '2663',
  a6 : '2660',
  a7 : '2022',
  a8 : '25D8',
  a9 : '25CB',
  a10 : '25D9',
  a11 : '2642',
  a12 : '2640',
  a13 : '266A',
  a14 : '266B',
  a15 : '263C',
  a16 : '25BA',
  a17 : '25C4',
  a18 : '2195',
  a19 : '203C',
  a20 : '00B6',
  a21 : '00A7',
  a22 : '25AC',
  a23 : '21A8',
  a24 : '2191',
  a25 : '2193',
  a26 : '2192',
  a27 : '2190',
  a28 : '221F',
  a29 : '2194',
  a30 : '25B2',
  a31 : '25BC',
  a127 : '2302',
  a128 : '00C7',
  a129 : '00FC',
  a130 : '00E9',
  a131 : '00E2',
  a132 : '00E4',
  a133 : '00E0',
  a134 : '00E5',
  a135 : '00E7',
  a136 : '00EA',
  a137 : '00EB',
  a138 : '00E8',
  a139 : '00EF',
  a140 : '00EE',
  a141 : '00EC',
  a142 : '00C4',
  a143 : '00C5',
  a144 : '00C9',
  a145 : '00E6',
  a146 : '00C6',
  a147 : '00F4',
  a148 : '00F6',
  a149 : '00F2',
  a150 : '00FB',
  a151 : '00F9',
  a152 : '00FF',
  a153 : '00D6',
  a154 : '00DC',
  a155 : '00A2',
  a156 : '00A3',
  a157 : '00A5',
  a158 : '20A7',
  a159 : '0192',
  a160 : '00E1',
  a161 : '00ED',
  a162 : '00F3',
  a163 : '00FA',
  a164 : '00F1',
  a165 : '00D1',
  a166 : '00AA',
  a167 : '00BA',
  a168 : '00BF',
  a169 : '2310',
  a170 : '00AC',
  a171 : '00BD',
  a172 : '00BC',
  a173 : '00A1',
  a174 : '00AB',
  a175 : '00BB',
  a176 : '2591',
  a177 : '2592',
  a178 : '2593',
  a179 : '2502',
  a180 : '2524',
  a181 : '00C1',
  a182 : '2562',
  a183 : '2556',
  a184 : '2555',
  a185 : '2563',
  a186 : '2551',
  a187 : '2557',
  a188 : '255D',
  a189 : '255C',
  a190 : '255B',
  a191 : '2510',
  a192 : '2514',
  a193 : '2534',
  a194 : '252C',
  a195 : '251C',
  a196 : '2500',
  a197 : '253C',
  a198 : '255E',
  a199 : '255F',
  a200 : '255A',
  a201 : '2554',
  a202 : '2569',
  a203 : '2566',
  a204 : '2560',
  a205 : '2550',
  a206 : '256C',
  a207 : '2567',
  a208 : '2568',
  a209 : '2564',
  a210 : '2565',
  a211 : '2559',
  a212 : '2558',
  a213 : '2552',
  a214 : '2553',
  a215 : '256B',
  a216 : '256A',
  a217 : '2518',
  a218 : '250C',
  a219 : '2588',
  a220 : '2584',
  a221 : '258C',
  a222 : '2590',
  a223 : '2580',
  a224 : '03B1',
  a225 : '00DF',
  a226 : '0393',
  a227 : '03C0',
  a228 : '03A3',
  a229 : '03C3',
  a230 : '00B5',
  a231 : '03C4',
  a232 : '03A6',
  a233 : '0398',
  a234 : '03A9',
  a235 : '03B4',
  a236 : '221E',
  a237 : '03C6',
  a238 : '03B5',
  a239 : '2229',
  a240 : '2261',
  a241 : '00B1',
  a242 : '2265',
  a243 : '2264',
  a244 : '2320',
  a245 : '2321',
  a246 : '00F7',
  a247 : '2248',
  a248 : '00B0',
  a249 : '2219',
  a250 : '00B7',
  a251 : '221A',
  a252 : '207F',
  a253 : '00B2',
  a254 : '25A0',
  a255 : '00A0',
  a0160 : '00A0',
  a0161 : '00A1',
  a0162 : '00A2',
  a0163 : '00A3',
  a0164 : '00A4',
  a0165 : '00A5',
  a0166 : '00A6',
  a0167 : '00A7',
  a0168 : '00A8',
  a0169 : '00A9',
  a0170 : '00AA',
  a0171 : '00AB',
  a0172 : '00AC',
  a0173 : '00AD',
  a0174 : '00AE',
  a0175 : '00AF',
  a0176 : '00B0',
  a0177 : '00B1',
  a0178 : '00B2',
  a0179 : '00B3',
  a0180 : '00B4',
  a0181 : '00B5',
  a0182 : '00B6',
  a0183 : '00B7',
  a0184 : '00B8',
  a0185 : '00B9',
  a0186 : '00BA',
  a0187 : '00BB',
  a0188 : '00BC',
  a0189 : '00BD',
  a0190 : '00BE',
  a0191 : '00BF',
  a0192 : '00C0',
  a0193 : '00C1',
  a0194 : '00C2',
  a0195 : '00C3',
  a0196 : '00C4',
  a0197 : '00C5',
  a0198 : '00C6',
  a0199 : '00C7',
  a0200 : '00C8',
  a0201 : '00C9',
  a0202 : '00CA',
  a0203 : '00CB',
  a0204 : '00CC',
  a0205 : '00CD',
  a0206 : '00CE',
  a0207 : '00CF',
  a0208 : '00D0',
  a0209 : '00D1',
  a0210 : '00D2',
  a0211 : '00D3',
  a0212 : '00D4',
  a0213 : '00D5',
  a0214 : '00D6',
  a0215 : '00D7',
  a0216 : '00D8',
  a0217 : '00D9',
  a0218 : '00DA',
  a0219 : '00DB',
  a0220 : '00DC',
  a0221 : '00DD',
  a0222 : '00DE',
  a0223 : '00DF',
  a0224 : '00E0',
  a0225 : '00E1',
  a0226 : '00E2',
  a0227 : '00E3',
  a0228 : '00E4',
  a0229 : '00E5',
  a0230 : '00E6',
  a0231 : '00E7',
  a0232 : '00E8',
  a0233 : '00E9',
  a0234 : '00EA',
  a0235 : '00EB',
  a0236 : '00EC',
  a0237 : '00ED',
  a0238 : '00EE',
  a0239 : '00EF',
  a0240 : '00F0',
  a0241 : '00F1',
  a0242 : '00F2',
  a0243 : '00F3',
  a0244 : '00F4',
  a0245 : '00F5',
  a0246 : '00F6',
  a0247 : '00F7',
  a0248 : '00F8',
  a0249 : '00F9',
  a0250 : '00FA',
  a0251 : '00FB',
  a0252 : '00FC',
  a0253 : '00FD',
  a0254 : '00FE',
  a0255 : '00FF',
  a0140 : '0152',
  a0156 : '0153',
  a0138 : '0160',
  a0154 : '0161',
  a0159 : '0178',
  a0142 : '017D',
  a0158 : '017E',
  a0131 : '0192',
  a0136 : '02C6',
  a0152 : '02DC',
  a0150 : '2013',
  a0151 : '2014',
  a0145 : '2018',
  a0146 : '2019',
  a0130 : '201A',
  a0147 : '201C',
  a0148 : '201D',
  a0132 : '201E',
  a0134 : '2020',
  a0135 : '2021',
  a0149 : '2022',
  a0133 : '2026',
  a0137 : '2030',
  a0139 : '2039',
  a0155 : '203A',
  a0128 : '20AC',
  a0153 : '2122',
};

var entercode=function(event){
  if (event.which=='45'||event.keyCode=='45'){
    var symbol ='';
    var character = prompt('Please enter a character code: aXXX for an Alt Code, uXXXX for a Unicode code.');
    character = character.toLowerCase();
    character = character.replace(/[^a-zA-Z0-9]/gi,'');
    if (character.charAt(0)=='a' && characters[character]) {
      symbol = String.fromCharCode('0x'+characters[character]);
    }
    if (character.charAt(0)=='u' && character.length>4) {
      symbol = String.fromCharCode('0x'+character.substr(1,4));
    }
    if (character.charAt(0)=='c') {
      symbol = String.fromCharCode('0x00A9');
    }
    if (character.length==4 && character.charAt(0)!='a') {
      symbol = String.fromCharCode('0x'+character);
    }
    if (!symbol) {symbol = '';}

    var activeEl=getActiveElement();
    var cursorPosition = activeEl.selectionStart;
    var text=activeEl.value;
    var start = text.slice(0,cursorPosition);
    var chars = text.slice(cursorPosition,cursorPosition);
    var end = text.slice(cursorPosition);
    var newText = start + symbol + end;
    activeEl.value = start + symbol + end;
    activeEl.setSelectionRange(cursorPosition+1, cursorPosition+1);
  }
};

window.onkeydown=entercode;